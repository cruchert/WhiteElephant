<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Secret Santa 2025</title>
<style>
  body {margin:0; height:100vh; background:#900; color:white; font-family:Arial, sans-serif;
        display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center;
        overflow:hidden; position:relative;}
  h1 {font-size:3.2em; text-shadow:0 0 20px gold; z-index:10;}
  input {padding:18px; font-size:1.8em; width:90%; max-width:420px; text-align:center; border-radius:15px; border:none; margin:15px; z-index:10;}
  button {padding:20px 50px; font-size:2em; background:#fff; color:#c00; border:none; border-radius:20px; cursor:pointer; box-shadow:0 8px 20px rgba(0,0,0,0.4); z-index:10;}
  button:active {transform:translateY(4px);}
  .big {font-size:4.8em; font-weight:bold; margin:30px 0; text-shadow:0 0 20px gold; z-index:10;}
  .small {font-size:1.4em; z-index:10;}
  .emoji {position:absolute; font-size:2.5em; pointer-events:none; animation:fall linear forwards; z-index:1;}
  @keyframes fall {to {transform:translateY(110vh) rotate(360deg); opacity:0;}}
  .testbtn {position:fixed; top:10px; right:10px; font-size:0.9em; padding:8px 12px; background:#000; opacity:0.6; z-index:100;}
</style>
</head>
<body>

<h1>Secret Santa 2025</h1>

<div id="enterName">
  <p>Type your name exactly as it appears below:</p>
  <input type="text" id="nameInput" placeholder="e.g. Grandma Lisa" autocomplete="off">
  <br>
  <button id="goBtn">Get My Person!</button>

  <p class="small"><strong>Names:</strong><br>
  Kylie • Nick • Kendra • Kaedynce • Rylee • Marin • Ellie • Zeke • Rayne • Drea • Brandon • Grandma Lisa • Grandma Chris • Roberto • Diego • JJ
  </p>
</div>

<div id="result" style="display:none;">
  <p>Hello</p>
  <div class="big" id="personName"></div>
  <p>You are buying a gift for:</p>
  <div class="big" id="target"></div>
  <p class="big">Keep it secret!<br>Merry Christmas</p>
</div>

<script>
const family = ["Kylie","Nick","Kendra","Kaedynce","Rylee","Marin","Ellie","Zeke","Rayne","Drea","Brandon","Grandma Lisa","Grandma Chris","Roberto","Diego","JJ"];
const STORAGE_KEY = "SecretSanta2025_Final";

let assignments = {};
let used = new Set();

const saved = localStorage.getItem(STORAGE_KEY);
if (saved) {
  const data = JSON.parse(saved);
  assignments = data.assignments || {};
  used = new Set(Object.values(assignments));
}

document.getElementById("goBtn").addEventListener("click", pick);

function pick() {
  const input = document.getElementById("nameInput").value.trim();
  const person = family.find(n => n.toLowerCase() === input.toLowerCase());

  if (!person) {
    alert("Name not found — check spelling!");
    return;
  }

  if (assignments[person]) {
    showResult(person, assignments[person]);
    return;
  }

  const available = family.filter(n => n !== person && !used.has(n));
  if (available.length === 0) {
    alert("Everyone already has a person!");
    return;
  }

  const chosen = available[Math.floor(Math.random() * available.length)];
  assignments[person] = chosen;
  used.add(chosen);
  localStorage.setItem(STORAGE_KEY, JSON.stringify({assignments}));
  showResult(person, chosen);
}

function showResult(person, target) {
  document.getElementById("personName").textContent = person;
  document.getElementById("target").textContent = target;
  document.getElementById("enterName").style.display = "none";
  document.getElementById("result").style.display = "block";
}

// Falling Christmas emojis
const emojis = ["Candy Cane","Christmas Tree","Santa","Snowman","Snowflake","Gift","Bell","Star"];
setInterval(() => {
  if (Math.random() < 0.7) {
    const e = document.createElement("div");
    e.textContent = emojis[Math.floor(Math.random()*emojis.length)];
    e.className = "emoji";
    e.style.left = Math.random()*100 + "vw";
    e.style.animationDuration = (Math.random()*4 + 4) + "s";
    document.body.appendChild(e);
    setTimeout(() => e.remove(), 10000);
  }
}, 400);

// TEST / RESET BUTTON (only you see this)
const testBtn = document.createElement("button");
testBtn.textContent = "RESET ALL (for testing)";
testBtn.className = "testbtn";
testBtn.onclick = () => {
  if (confirm("Clear EVERYONE'S picks? (only for testing)")) {
    localStorage.removeItem(STORAGE_KEY);
    location.reload();
  }
};
document.body.appendChild(testBtn);
</script>
</body>
</html>