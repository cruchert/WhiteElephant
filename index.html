<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>White Elephant 2025 â€“ Secret Picker</title>
  <style>
    body {font-family: Arial, sans-serif; text-align:center; background:#c00; color:white; padding:20px; min-height:100vh;}
    h1 {font-size:2.5em;}
    .container {max-width:600px; margin:0 auto; background:rgba(0,0,0,0.3); padding:30px; border-radius:20px;}
    select, button {padding:15px; font-size:1.3em; margin:10px; width:90%; border-radius:10px;}
    button {background:#fff; color:#c00; border:none; cursor:pointer;}
    .done {background:#333; color:#aaa;}
    .links {margin-top:40px; background:rgba(0,0,0,0.4); padding:20px; border-radius:15px; text-align:left; font-size:1.1em;}
    a {color:#ff0; display:block; margin:8px 0; word-break:break-all;}
  </style>
</head>
<body>

<div class="container">
  <h1>White Elephant 2025<br>Secret Picker Generator</h1>
  <p>Scroll down to get the 16 unique links â€“ send each person ONLY their own link!</p>
  
  <div class="links" id="linkList"></div>
</div>

<script>
// ====================  EDIT THIS LIST ONCE  ====================
const family = [
  "Kylie","Nick","Kendra","Kaedynce","Rylee","Marin",
  "Ellie","Zeke","Rayne","Drea","Brandon",
  "Grandma Lisa","Grandma Chris","Roberto","Diego","JJ"
];
// ================================================================

const baseUrl = location.href.split('?')[0];  // works even on Netlify/GitHub Pages

let html = "<h3>Unique secret links (copy & send):</h3>";
family.forEach((name, i) => {
  const token = btoa(Math.random()).substring(5,15); // random unique token
  const url = `${baseUrl}?picker=${encodeURIComponent(name)}&t=${token}`;
  html += `<strong>${name}:</strong><br><a href="${url}">${url}</a><hr>`;
  // Store empty choices for this token
  localStorage.setItem(token, JSON.stringify([]));
});
document.getElementById("linkList").innerHTML = html;

// If someone opened their personal link â†’ show picker
const params = new URLSearchParams(location.search);
const pickerName = params.get("picker");

if (pickerName) {
  document.body.innerHTML = `
    <div class="container">
      <h1>Hello ${pickerName}!</h1>
      <p>Who did <strong>you</strong> buy a gift for?</p>
      <select id="chosen"></select><br>
      <button id="submitBtn">Lock in my choice ðŸŽ„</button>
      <p id="status"></p>
    </div>`;

  const select = document.getElementById("chosen");
  const allChoices = {};

  // Load everyone's choices so far
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key.length === 10) { // our random tokens are ~10 chars
      const arr = JSON.parse(localStorage.getItem(key) || "[]");
      arr.forEach(obj => allChoices[obj.who] = obj.by);
    }
  }

  // Build dropdown (exclude self + already picked)
  family.forEach(name => {
    if (name !== pickerName && !allChoices[name]) {
      const opt = document.createElement("option");
      opt.value = name;
      opt.textContent = name;
      select.appendChild(opt);
    }
  });

  if (select.options.length === 0) {
    document.getElementById("status").innerHTML = "<h2>All gifts assigned!<br>Merry Christmas ðŸŽ…</h2>";
    document.getElementById("submitBtn").style.display = "none";
  }

  document.getElementById("submitBtn").onclick = () => {
    const chosen = select.value;
    if (!chosen) return;
    
    // Save this choice under OUR token
    const myToken = params.get("t");
    const previous = JSON.parse(localStorage.getItem(myToken) || "[]");
    previous.push({who: chosen, by: pickerName});
    localStorage.setItem(myToken, JSON.stringify(previous));

    document.body.innerHTML = `<div class="container"><h1>Thank you ${pickerName}!</h1>
      <h2>You are buying for:<br><br><strong>${chosen}</strong></h2>
      <p style="font-size:2em">ðŸ¤« Keep it secret!</p></div>`;
  };
}
</script>
</body>
</html>